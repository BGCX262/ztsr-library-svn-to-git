package library.client;

import java.rmi.RemoteException;
import library.common.*;
import javax.swing.JOptionPane;
import java.util.*;

/**
 * @author  Karolina
 */
public class FindPanel extends javax.swing.JPanel {
    
    private SessionData sData;
    private MenuPanel parentPanel;
    private ResultPanel resultPanel;
    
    /** Creates new form FindPanel */
    public FindPanel(SessionData s) {
        initComponents();
        this.setVisible(false);
        sData = s;
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        descriptionLabel = new javax.swing.JLabel();
        jPanel1 = new javax.swing.JPanel();
        autorLabel = new javax.swing.JLabel();
        titleLabel = new javax.swing.JLabel();
        publisherLabel = new javax.swing.JLabel();
        yearLabel = new javax.swing.JLabel();
        autorField = new javax.swing.JTextField();
        titleField = new javax.swing.JTextField();
        publisherField = new javax.swing.JTextField();
        yearField = new javax.swing.JTextField();
        exclusiveCheckBox = new javax.swing.JCheckBox();
        findButton = new javax.swing.JButton();
        returnButton = new javax.swing.JButton();

        descriptionLabel.setFont(new java.awt.Font("Tahoma", 1, 12));
        descriptionLabel.setText("Podaj dane na temat poszukiwanego egzemplarza:");

        autorLabel.setFont(new java.awt.Font("Tahoma", 1, 12));
        autorLabel.setText("Autor:");

        titleLabel.setFont(new java.awt.Font("Tahoma", 1, 12));
        titleLabel.setText("Tytu\u0142:");

        publisherLabel.setFont(new java.awt.Font("Tahoma", 1, 12));
        publisherLabel.setText("Wydawnictwo:");

        yearLabel.setFont(new java.awt.Font("Tahoma", 1, 12));
        yearLabel.setText("Rok wydania:");

        autorField.setFont(new java.awt.Font("Tahoma", 0, 12));

        titleField.setFont(new java.awt.Font("Tahoma", 0, 12));

        publisherField.setFont(new java.awt.Font("Tahoma", 0, 12));

        yearField.setFont(new java.awt.Font("Tahoma", 0, 12));

        exclusiveCheckBox.setFont(new java.awt.Font("Tahoma", 1, 12));
        exclusiveCheckBox.setText("Tylko z dost\u0119pnymi egzemplarzami");
        exclusiveCheckBox.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        exclusiveCheckBox.setMargin(new java.awt.Insets(0, 0, 0, 0));

        org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(jPanel1Layout.createSequentialGroup()
                        .add(autorLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 55, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(autorField, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 552, Short.MAX_VALUE))
                    .add(jPanel1Layout.createSequentialGroup()
                        .add(titleLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 56, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                        .add(titleField, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 551, Short.MAX_VALUE))
                    .add(jPanel1Layout.createSequentialGroup()
                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, publisherLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .add(org.jdesktop.layout.GroupLayout.LEADING, yearLabel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 93, Short.MAX_VALUE))
                        .add(10, 10, 10)
                        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(jPanel1Layout.createSequentialGroup()
                                .add(yearField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 56, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                                .add(416, 416, 416))
                            .add(publisherField, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 508, Short.MAX_VALUE)))
                    .add(exclusiveCheckBox, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 312, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(jPanel1Layout.createSequentialGroup()
                .add(36, 36, 36)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(autorLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(autorField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(titleLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 27, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(titleField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(publisherLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 29, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(publisherField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .add(18, 18, 18)
                .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(yearLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 25, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                    .add(yearField, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(exclusiveCheckBox, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 48, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        findButton.setFont(new java.awt.Font("Tahoma", 1, 12));
        findButton.setText("Szukaj");
        findButton.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                findButtonKeyPressed(evt);
            }
        });
        findButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                findButtonMouseClicked(evt);
            }
        });

        returnButton.setFont(new java.awt.Font("Tahoma", 1, 12));
        returnButton.setText("Powr\u00f3t");
        returnButton.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                returnButtonKeyPressed(evt);
            }
        });
        returnButton.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                returnButtonMouseClicked(evt);
            }
        });

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(layout.createSequentialGroup()
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                    .add(layout.createSequentialGroup()
                        .add(161, 161, 161)
                        .add(findButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 132, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                        .add(110, 110, 110)
                        .add(returnButton, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 125, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
                    .add(layout.createSequentialGroup()
                        .add(30, 30, 30)
                        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
                            .add(descriptionLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 326, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                            .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(32, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
                .addContainerGap(83, Short.MAX_VALUE)
                .add(descriptionLabel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 24, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(25, 25, 25)
                .add(jPanel1, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .add(81, 81, 81)
                .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
                    .add(findButton)
                    .add(returnButton))
                .add(32, 32, 32))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void returnButtonKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_returnButtonKeyPressed
        if(evt.getKeyCode() == evt.VK_ENTER){
            this.returnButtonAccept();
        }
    }//GEN-LAST:event_returnButtonKeyPressed

    private void findButtonKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_findButtonKeyPressed
        if(evt.getKeyCode() == evt.VK_ENTER){
            this.findButtonAccept();
        }
    }//GEN-LAST:event_findButtonKeyPressed

    private void returnButtonAccept(){
        this.clearFields();
        this.setVisible(false);
        parentPanel.setVisible(true);    
    }
    
    private void returnButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_returnButtonMouseClicked
        this.returnButtonAccept();
    }//GEN-LAST:event_returnButtonMouseClicked

    private void  findButtonAccept(){
        SearchPattern s = new SearchPattern();
        if ((!this.yearField.getText().equalsIgnoreCase(""))&&(this.yearField.getText()!=null)){
            try{
                int year = Integer.parseInt(this.yearField.getText());
                s.setPublishYear(year);
            }catch(NumberFormatException e){
                JOptionPane.showMessageDialog(this, "B³êdny format roku wydania!","Uwaga",JOptionPane.WARNING_MESSAGE);
                this.yearField.requestFocus();
                return;
            }
        }
        s.setAuthor(this.autorField.getText());
        s.setTitle(this.titleField.getText());
        s.setPublisher(this.publisherField.getText());
        s.onlyAvailableCopies = this.exclusiveCheckBox.isSelected();
        
        try{
            Collection<Book> books = sData.getLibrary().findBooks(s);
            this.setVisible(false);
            resultPanel.displayResults(books);
        }catch (RemoteException e){
            JOptionPane.showMessageDialog(this, e.detail.getLocalizedMessage(),"Uwaga",JOptionPane.WARNING_MESSAGE);
        }
    }
    private void findButtonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_findButtonMouseClicked
        this.findButtonAccept();
    }//GEN-LAST:event_findButtonMouseClicked
    
    private void clearFields(){
        this.autorField.setText("");
        this.titleField.setText("");
        this.publisherField.setText("");
        this.yearField.setText("");
        this.exclusiveCheckBox.setSelected(false);
    }
    public void setParentPanel(MenuPanel p) { parentPanel = p; }
    
    public void setResultPanel(ResultPanel r) { resultPanel = r; }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField autorField;
    private javax.swing.JLabel autorLabel;
    private javax.swing.JLabel descriptionLabel;
    private javax.swing.JCheckBox exclusiveCheckBox;
    private javax.swing.JButton findButton;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTextField publisherField;
    private javax.swing.JLabel publisherLabel;
    private javax.swing.JButton returnButton;
    private javax.swing.JTextField titleField;
    private javax.swing.JLabel titleLabel;
    private javax.swing.JTextField yearField;
    private javax.swing.JLabel yearLabel;
    // End of variables declaration//GEN-END:variables
    
}
